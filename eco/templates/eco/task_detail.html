{% extends 'eco/base.html' %}

{% block title %}{{ task.title }} - EcoApp{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="bg-white rounded-2xl shadow-2xl overflow-hidden" data-aos="fade-up">
        {% if task.example_photo %}
            <img src="{{ task.example_photo.url }}" alt="{{ task.title }}" class="w-full h-96 object-cover">
        {% else %}
            <div class="w-full h-96 bg-gradient-to-r from-green-400 to-green-600 flex items-center justify-center">
                <span class="text-9xl">🌿</span>
            </div>
        {% endif %}
        
        <div class="p-8">
            <div class="flex items-start justify-between mb-6">
                <h1 class="text-3xl font-bold text-gray-900">{{ task.title }}</h1>
                <div class="flex items-center space-x-2 bg-yellow-50 px-4 py-2 rounded-full">
                    <span class="text-yellow-500 text-3xl">🪙</span>
                    <span class="text-2xl font-bold text-green-600">{{ task.coin_reward }}</span>
                </div>
            </div>
            
            {% if task.deadline %}
                <div class="mb-6 inline-block bg-blue-50 px-4 py-2 rounded-lg">
                    <span class="text-blue-600 font-semibold">📅 Deadline: {{ task.deadline|date:"F d, Y" }}</span>
                </div>
            {% endif %}
            
            <div class="prose max-w-none mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-3">Description</h2>
                <p class="text-gray-700 leading-relaxed whitespace-pre-line">{{ task.description }}</p>
            </div>
            
            {% if user_submission %}
                <div class="bg-gray-50 border-l-4 {% if user_submission.status == 'approved' %}border-green-500{% elif user_submission.status == 'rejected' %}border-red-500{% else %}border-yellow-500{% endif %} p-6 rounded-r-lg">
                    <h3 class="text-lg font-bold mb-2 
                        {% if user_submission.status == 'approved' %}text-green-700
                        {% elif user_submission.status == 'rejected' %}text-red-700
                        {% else %}text-yellow-700{% endif %}">
                        Your Submission: {{ user_submission.get_status_display }}
                    </h3>
                    
                    {% if user_submission.image %}
                        <img src="{{ user_submission.image.url }}" alt="Submission" class="w-full max-w-md rounded-lg mb-4">
                    {% endif %}
                    
                    <p class="text-gray-700 mb-2"><strong>Your notes:</strong> {{ user_submission.description }}</p>
                    
                    {% if user_submission.status == 'pending' %}
                        <p class="text-yellow-700 font-semibold">⏳ Your submission is under review</p>
                    {% elif user_submission.status == 'approved' %}
                        <p class="text-green-700 font-semibold">✅ Approved! You earned {{ task.coin_reward }} coins!</p>
                    {% elif user_submission.status == 'rejected' %}
                        <p class="text-red-700 font-semibold">❌ Rejected</p>
                        {% if user_submission.moderator_comment %}
                            <p class="text-gray-700 mt-2"><strong>Moderator feedback:</strong> {{ user_submission.moderator_comment }}</p>
                        {% endif %}
                    {% endif %}
                </div>
            {% else %}
                {% if user.is_authenticated %}
                    <a href="{% url 'submit_task' task.id %}" class="inline-block bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-lg font-semibold transition transform hover:scale-105">
                        Submit This Task
                    </a>
                {% else %}
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-r-lg">
                        <p class="text-blue-700 font-semibold">Please <a href="{% url 'login' %}" class="underline">login</a> to submit this task.</p>
                    </div>
                {% endif %}
            {% endif %}
        </div>
    </div>
    
    <div class="mt-6">
        <a href="{% url 'tasks' %}" class="text-green-600 hover:text-green-700 font-semibold">← Back to all tasks</a>
    </div>
</div>
{% endblock %}